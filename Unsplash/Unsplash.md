

[![Python](https://img.shields.io/badge/Python-3.6%2B-blue.svg)](https://www.python.org/)
[![Selenium](https://img.shields.io/badge/Selenium-4.0%2B-green.svg)](https://www.selenium.dev/)
[![Redis](https://img.shields.io/badge/Redis-3.0%2B-red.svg)](https://redis.io/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Unsplash](https://img.shields.io/badge/Unsplash-Image%20Spider-yellow.svg)](https://unsplash.com/)
![Unsplash å¤šçº¿ç¨‹å›¾ç‰‡çˆ¬è™«](https://github.com/fuaneng/Auto_Image-Spider/Unsplash/unsplash_com.png)

# ğŸ“¸ Unsplash å¤šçº¿ç¨‹å›¾ç‰‡çˆ¬è™« (Unsplash-Concurrent-Spider.py)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Python å’Œ Selenium çš„é«˜æ€§èƒ½å¤šçº¿ç¨‹çˆ¬è™«ï¼Œä¸“ä¸ºä» Unsplash ç½‘ç«™å¼‚æ­¥æŠ“å–å¤§é‡å›¾ç‰‡é“¾æ¥å’Œå…ƒæ•°æ®è€Œè®¾è®¡ã€‚é€šè¿‡ä½¿ç”¨å¤šçº¿ç¨‹å’Œä¿¡å·é‡æœºåˆ¶ï¼Œå®ƒå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªæœç´¢æ ‡ç­¾ï¼Œå¤§å¤§æé«˜äº†æ•°æ®é‡‡é›†æ•ˆç‡ã€‚

## âœ¨ ç‰¹æ€§

  * **å¤šçº¿ç¨‹å¹¶å‘ï¼š** é»˜è®¤æ”¯æŒ **5 ä¸ª** ç‹¬ç«‹çš„æµè§ˆå™¨å®ä¾‹ï¼ˆå¯é…ç½®ï¼‰ï¼Œå¼‚æ­¥å¤„ç†ä¸åŒçš„æœç´¢ä»»åŠ¡ï¼Œäº’ä¸å¹²æ‰°ã€‚
  * **å¥å£®æ€§é«˜ï¼š** å†…ç½®äº†é’ˆå¯¹ Selenium å¸¸è§çš„ `StaleElementReferenceException` (å…ƒç´ å¤±æ•ˆ) é”™è¯¯çš„é‡è¯•æœºåˆ¶ã€‚
  * **æ— é™æ»šåŠ¨å¤„ç†ï¼š** è‡ªåŠ¨æ¨¡æ‹Ÿç”¨æˆ·æ»šåŠ¨ï¼Œå¹¶å…·å¤‡è¯†åˆ«å†…å®¹åŠ è½½å®Œæ¯•æˆ–åˆ°è¾¾æœ€å¤§æ»šåŠ¨æ¬¡æ•°çš„æ™ºèƒ½åœæ­¢æœºåˆ¶ã€‚
  * **å»é‡æœºåˆ¶ï¼š** é»˜è®¤æ”¯æŒ **Redis** è¿›è¡Œè·¨ä»»åŠ¡ URL å»é‡ï¼Œè‹¥ Redis è¿æ¥å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§ä¸ºå†…å­˜å»é‡ã€‚
  * **æ— å¤´æ¨¡å¼ï¼š** æ”¯æŒåœ¨åå°è¿è¡Œæµè§ˆå™¨ï¼ˆ`headless` æ¨¡å¼ï¼‰ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºã€‚

## âš™ï¸ ç¯å¢ƒè¦æ±‚

åœ¨è¿è¡Œæœ¬é¡¹ç›®ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä½ çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š

1.  **æ“ä½œç³»ç»Ÿï¼š** Windows, macOS, æˆ– Linuxã€‚
2.  **Python ç‰ˆæœ¬ï¼š** Python 3.6 åŠä»¥ä¸Šã€‚
3.  **æµè§ˆå™¨ï¼š** æ¨èä½¿ç”¨ Google Chromeã€‚
4.  **ChromeDriverï¼š** ä¸ä½ çš„ Chrome æµè§ˆå™¨ç‰ˆæœ¬å…¼å®¹çš„ ChromeDriver å¯æ‰§è¡Œæ–‡ä»¶ã€‚
      * **è·å–æ–¹æ³•ï¼š** ä½ å¯ä»¥åœ¨ [ChromeDriver å®˜ç½‘](https://sites.google.com/chromium.org/driver/) ä¸‹è½½ä¸ä½  Chrome æµè§ˆå™¨ç‰ˆæœ¬å¯¹åº”çš„é©±åŠ¨ã€‚

### ğŸ“¦ å®‰è£…ä¾èµ–åº“

æœ¬é¡¹ç›®éœ€è¦ `selenium` å’Œ `redis` åº“ã€‚è¯·åœ¨ä½ çš„å‘½ä»¤è¡Œæˆ–ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š

```bash
pip install selenium redis
```

-----

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆåˆå­¦è€…æŒ‡å—ï¼‰

### æ­¥éª¤ä¸€ï¼šæ”¾ç½®æ–‡ä»¶å’Œè®¾ç½®æ ‡ç­¾åˆ—è¡¨

1.  **åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹ï¼š**
    åœ¨ä½ çš„ç”µè„‘ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ `unsplash_spider`ã€‚

2.  **åˆ›å»ºæ ‡ç­¾æ–‡ä»¶ï¼š**
    åœ¨ä½ çš„æ•°æ®ä¿å­˜ç›®å½•ä¸‹ï¼ˆä¾‹å¦‚ï¼š`D:\work\çˆ¬è™«\çˆ¬è™«æ•°æ®\unsplash`ï¼‰ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º `ram_tag_list_å¤‡ä»½.txt` çš„æ–‡æœ¬æ–‡ä»¶ã€‚
    åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæ¯è¡Œè¾“å…¥ä¸€ä¸ªä½ æƒ³çˆ¬å–çš„æœç´¢å…³é”®è¯æˆ–æ ‡ç­¾ã€‚

    **`ram_tag_list_å¤‡ä»½.txt` ç¤ºä¾‹ï¼š**

    ```
    nature photography
    minimalist wallpaper
    city light
    monastery
    ocean waves
    ...
    ```

3.  **é…ç½® ChromeDriver è·¯å¾„ï¼š**
    ç¡®ä¿ä½ å·²ç»ä¸‹è½½äº† `chromedriver.exe` å¹¶çŸ¥é“å®ƒçš„å®Œæ•´è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š`C:\path\to\chromedriver.exe`ï¼‰ã€‚

### æ­¥éª¤äºŒï¼šä¿®æ”¹é…ç½®å‚æ•°

æ‰“å¼€ä½ çš„ Python çˆ¬è™«æ–‡ä»¶ï¼Œæ‰¾åˆ° `if __name__ == '__main__':` ä¸‹æ–¹çš„ **é…ç½®éƒ¨åˆ†**ï¼Œæ ¹æ®ä½ çš„å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚

```python
if __name__ == '__main__':
    # âš ï¸ é…ç½®éƒ¨åˆ†ï¼šè¯·ä¿®æ”¹ä¸ºä½ è‡ªå·±çš„è·¯å¾„å’Œè®¾ç½®
    chrome_driver_path = r'C:\Program Files\Google\chromedriver-win32\chromedriver.exe'  # <--- ã€å¿…æ”¹ã€‘ChromeDriver è·¯å¾„
    save_dir = r'D:\work\çˆ¬è™«\çˆ¬è™«æ•°æ®\unsplash'                                         # <--- ã€å¿…æ”¹ã€‘æ•°æ®ä¿å­˜çš„æ ¹ç›®å½•
    tag_file_path = r'D:\work\çˆ¬è™«\çˆ¬è™«æ•°æ®\unsplash\ram_tag_list_å¤‡ä»½.txt'               # <--- ã€å¿…æ”¹ã€‘æ ‡ç­¾æ–‡ä»¶è·¯å¾„
    csv_name = 'all_records_unsplash.csv'                                         # æœ€ç»ˆè¾“å‡ºçš„ CSV æ–‡ä»¶å
    use_headless = True                                                           # æ˜¯å¦å¯ç”¨æ— å¤´æ¨¡å¼ (True: åå°è¿è¡Œ; False: æ˜¾ç¤ºæµè§ˆå™¨çª—å£)
    
    # ğŸš€ å¹¶å‘æ§åˆ¶è®¾ç½®
    MAX_THREADS = DEFAULT_MAX_THREADS  # é»˜è®¤è®¾ç½®ä¸º 5 ä¸ªå¹¶å‘çº¿ç¨‹ (å³åŒæ—¶æ‰“å¼€ 5 ä¸ªæµè§ˆå™¨)
    # ... (å…¶ä»–ä»£ç )
```

### æ­¥éª¤ä¸‰ï¼šè¿è¡Œçˆ¬è™«

åœ¨å‘½ä»¤è¡Œæˆ–ç»ˆç«¯ä¸­ï¼Œå¯¼èˆªåˆ°ä½ çš„ Python æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼Œå¹¶è¿è¡Œè„šæœ¬ï¼š

```bash
python your_spider_file_name.py
```

ç¨‹åºå°†å¼€å§‹è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°æœ€å¤š 5 ä¸ªæµè§ˆå™¨å®ä¾‹ï¼ˆå¦‚æœ `use_headless` ä¸º `False`ï¼‰è¢«å¯åŠ¨ï¼Œå¹¶å¼€å§‹å¹¶è¡Œå¤„ç†ä½ çš„æ ‡ç­¾åˆ—è¡¨ã€‚

-----

## ğŸ› ï¸ é«˜çº§é…ç½® (å¯é€‰)

### 1\. è°ƒæ•´å¹¶å‘çº¿ç¨‹æ•°

å¦‚æœä½ å¸Œæœ›åŒæ—¶è¿è¡Œæ›´å¤šæˆ–æ›´å°‘çš„æµè§ˆå™¨å®ä¾‹ï¼Œå¯ä»¥ä¿®æ”¹ `MAX_THREADS` å‚æ•°ã€‚

```python
    # ğŸš€ å¹¶å‘æ§åˆ¶è®¾ç½®
    MAX_THREADS = 10  # ä¾‹å¦‚ï¼Œè®¾ç½®ä¸º 10 ä¸ªçº¿ç¨‹ï¼Œå–å†³äºä½ çš„è®¡ç®—æœºæ€§èƒ½
    semaphore = threading.Semaphore(MAX_THREADS)
```

### 2\. è°ƒæ•´æ»šåŠ¨ç­–ç•¥

è¿™äº›å‚æ•°ä½äºæ–‡ä»¶çš„æœ€ä¸Šæ–¹ï¼Œç”¨äºæ§åˆ¶çˆ¬è™«åœ¨æ— é™æ»šåŠ¨é¡µé¢ä¸Šçš„è¡Œä¸ºï¼š

| å‚æ•° | é»˜è®¤å€¼ | å»ºè®®ç”¨é€” |
| :--- | :--- | :--- |
| `MAX_SCROLLS` | `100` | ç½‘ç«™å›¾ç‰‡é‡æå¤§æ—¶ï¼Œå¯ä»¥è°ƒé«˜ï¼ˆä¾‹å¦‚ `200`ï¼‰ï¼Œå¦åˆ™ä¿æŒé»˜è®¤å³å¯ã€‚ |
| `NO_NEW_ROUNDS_TO_STOP` | `2` | ä¿æŒé»˜è®¤æˆ–è°ƒé«˜åˆ° `3`ã€‚æ­¤å€¼è¶Šå°ï¼Œçˆ¬è™«è¶Šæ—©åˆ¤æ–­é¡µé¢åˆ°åº•ï¼Œå¯èƒ½ç‰ºç‰²ä¸€ç‚¹å®Œæ•´æ€§ä½†æé«˜æ•ˆç‡ã€‚ |
| `SMALL_SCROLL_AMOUNT` | `200` | ç”¨äºå¾®è°ƒæ»šåŠ¨ï¼Œä¸€èˆ¬ä¸éœ€æ”¹åŠ¨ã€‚|

### 3\. Redis å»é‡

å¦‚æœä½ çš„æœ¬åœ°å®‰è£…äº† Redis æœåŠ¡ï¼ˆé»˜è®¤ç«¯å£ 6379ï¼‰ï¼Œä»£ç å°†è‡ªåŠ¨å¯ç”¨ Redis è¿›è¡Œå»é‡ã€‚

  * å¦‚æœä¸éœ€è¦ Redisï¼Œå¯ä»¥å°† `run_spider_task` å‡½æ•°ä¸­ä¼ å…¥çš„ Redis å‚æ•°è®¾ç½®ä¸ºä»»æ„ä¸æ­£ç¡®çš„å€¼ï¼Œä¾‹å¦‚ï¼š
    ```python
    # args=(tag, ..., 'wrong_host', 9999, semaphore)
    ```
    çˆ¬è™«å°†è‡ªåŠ¨è¯†åˆ«è¿æ¥å¤±è´¥ï¼Œå¹¶é™çº§ä¸ºä½¿ç”¨å†…å­˜ï¼ˆ`visited_md5` é›†åˆï¼‰è¿›è¡Œå»é‡ã€‚

## âš ï¸ å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
| :--- | :--- | :--- |
| `FileNotFoundError: ChromeDriver not found at path: ...` | `chrome_driver_path` è®¾ç½®ä¸æ­£ç¡®ã€‚ | æ£€æŸ¥å¹¶ä¿®æ­£ `chrome_driver_path` å˜é‡ä¸­çš„è·¯å¾„ã€‚ |
| `selenium.common.exceptions.SessionNotCreatedException` | ChromeDriver ç‰ˆæœ¬ä¸ Chrome æµè§ˆå™¨ç‰ˆæœ¬ä¸å…¼å®¹ã€‚| ä¸‹è½½ä¸ä½  Chrome æµè§ˆå™¨ç‰ˆæœ¬å®Œå…¨åŒ¹é…çš„ ChromeDriverã€‚ |
| çˆ¬å–ä¸­å‡ºç° `StaleElementReferenceException` | é¡µé¢ DOM ç»“æ„å¿«é€Ÿå˜åŒ–ã€‚| **å·²è§£å†³ã€‚** ä»£ç ä¸­å·²å†…ç½®é‡è¯•æœºåˆ¶ (`get_images` å‡½æ•°ä¸­çš„ `max_retries = 2`) æ¥å¤„ç†æ­¤é—®é¢˜ã€‚ |
| çˆ¬è™«è¿è¡Œé€Ÿåº¦æ…¢ï¼Œç”µè„‘å¡é¡¿ | å¹¶å‘çº¿ç¨‹æ•° (`MAX_THREADS`) è¿‡é«˜ã€‚| è°ƒä½ `MAX_THREADS`ï¼Œä¾‹å¦‚è®¾ç½®ä¸º `3` æˆ– `4`ï¼Œä»¥å‡è½» CPU å’Œå†…å­˜å‹åŠ›ã€‚|
| çˆ¬è™«æå‰ç»“æŸï¼Œå›¾ç‰‡ä¸å®Œæ•´ | `NO_NEW_ROUNDS_TO_STOP` è®¾ç½®è¿‡ä½ã€‚| é€‚å½“è°ƒé«˜ `NO_NEW_ROUNDS_TO_STOP` (ä¾‹å¦‚åˆ° `3`) æˆ– `MAX_SCROLLS`ã€‚ |