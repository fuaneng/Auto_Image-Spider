
# ğŸ“¸ Freenaturestock å›¾ç‰‡çˆ¬è™«é¡¹ç›®

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäºæ ‡ç­¾ã€æ”¯æŒåˆ†é¡µã€è§£è€¦å¼å¼‚æ­¥å¤šçº¿ç¨‹çš„ Python çˆ¬è™«ï¼Œç”¨äºä» `freenaturestock.com` ç½‘ç«™æŠ“å–æŒ‡å®šæ ‡ç­¾ä¸‹çš„é«˜æ¸…å›¾ç‰‡ URLã€‚

## âœ¨ é¡¹ç›®ç›®æ ‡ä¸åŠŸèƒ½

æœ¬é¡¹ç›®æ—¨åœ¨é«˜æ•ˆã€ç¨³å®šåœ°çˆ¬å–ç›®æ ‡ç½‘ç«™çš„å›¾ç‰‡æ•°æ®ï¼Œå…·å¤‡ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

| åŠŸèƒ½ | æè¿° | å®ç°ç»†èŠ‚ |
| :--- | :--- | :--- |
| **æ ‡ç­¾çˆ¬å–** | æ”¯æŒä»æœ¬åœ°æ–‡ä»¶è¯»å–å¤šä¸ªæœç´¢æ ‡ç­¾ï¼Œå¹¶ä¸ºæ¯ä¸ªæ ‡ç­¾ç‹¬ç«‹å¯åŠ¨çˆ¬å–ä»»åŠ¡ã€‚ | ä»æŒ‡å®šè·¯å¾„è¯»å–æ ‡ç­¾åˆ—è¡¨ã€‚ |
| **åˆ†é¡µå¤„ç†** | è‡ªåŠ¨å¤„ç†æœç´¢ç»“æœçš„å¤šé¡µåˆ†é¡µã€‚ | è¿ç»­è¯·æ±‚ `.../page/{é¡µç }/?s={tag}` URLã€‚ |
| **æ™ºèƒ½åœæ­¢** | è¯†åˆ«åˆ†é¡µç»“æŸçš„æ¡ä»¶ï¼Œè‡ªåŠ¨åœæ­¢è¯¥æ ‡ç­¾çš„çˆ¬å–ã€‚ | å½“è¿”å› **404 çŠ¶æ€ç ** æˆ– **æœªæå–åˆ°æ–°çš„å›¾ç‰‡é“¾æ¥** æ—¶åœæ­¢ã€‚ |
| **URL è¿‡æ»¤** | ä¸¥æ ¼é™åˆ¶æŠ“å–çš„å›¾ç‰‡æ¥æºã€‚ | **åªæŠ“å–**ä»¥ `https://freenaturestock.com/` å¼€å¤´çš„å›¾ç‰‡ URLã€‚ |
| **æ•°æ®æ¸…æ´—** | æ¸…ç† URL ä¸­çš„å†—ä½™ä¿¡æ¯ï¼Œæ ‡å‡†åŒ–æ•°æ®ã€‚ | ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç§»é™¤å›¾ç‰‡ URL ä¸­çš„å°ºå¯¸åˆ†è¾¨ç‡ä¿¡æ¯ï¼ˆå¦‚ `"-768x512"`ï¼‰ã€‚ |
| **é«˜æ•ˆå»é‡** | ç¡®ä¿æŠ“å–åˆ°çš„å›¾ç‰‡ URL ä¸é‡å¤ã€‚ | ä¼˜å…ˆä½¿ç”¨ **Redis é›†åˆ**è¿›è¡ŒæŒä¹…åŒ–å»é‡ï¼Œè‹¥ Redis è¿æ¥å¤±è´¥ï¼Œåˆ™å›é€€åˆ° **å†…å­˜é›†åˆ**ã€‚ |
| **å¼‚æ­¥å¹¶å‘** | é‡‡ç”¨å¤šçº¿ç¨‹æœºåˆ¶åŠ é€Ÿçˆ¬å–è¿‡ç¨‹ã€‚ | ä½¿ç”¨ `ThreadPoolExecutor` ç®¡ç† **20 çº¿ç¨‹** å¹¶å‘ã€‚ |
| **å®æ—¶å­˜å‚¨** | å°†æ¸…æ´—åçš„æ•°æ®å®‰å…¨åœ°å†™å…¥ CSV æ–‡ä»¶ã€‚ | ä½¿ç”¨ **è¿½åŠ æ¨¡å¼ (`'a'`)** å®æ—¶å†™å…¥ï¼Œå¹¶é€šè¿‡ **çº¿ç¨‹é”** ç¡®ä¿å¤šçº¿ç¨‹å¹¶å‘å†™å…¥æ—¶çš„çº¿ç¨‹å®‰å…¨ã€‚ |

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

  * **è¯­è¨€:** Python 3.x
  * **ç½‘ç»œè¯·æ±‚:** `requests`
  * **HTML è§£æ:** `BeautifulSoup4`
  * **å¹¶å‘/å¼‚æ­¥:** `concurrent.futures.ThreadPoolExecutor` (å¤šçº¿ç¨‹)
  * **å»é‡ç¼“å­˜:** `redis`
  * **æ–‡ä»¶æ“ä½œ:** `os`, `csv`, `threading`

## ğŸ“‚ é¡¹ç›®ç»“æ„ï¼ˆä¼ªä»£ç åŸå‹ï¼‰

é¡¹ç›®åŸºäºé¢å‘å¯¹è±¡è®¾è®¡ï¼ˆ`FreenaturestockScraper` ç±»ï¼‰ï¼Œå°†çˆ¬å–é€»è¾‘ã€å»é‡é€»è¾‘å’Œå­˜å‚¨é€»è¾‘è¿›è¡Œå°è£…ã€‚

```
.
â”œâ”€â”€ çˆ¬è™«ä»£ç .py
â”œâ”€â”€ ram_tag_list_å¤‡ä»½.txt (æ ‡ç­¾è¾“å…¥æ–‡ä»¶)
â””â”€â”€ çˆ¬è™«æ•°æ®/
    â””â”€â”€ freenaturestock/
        â””â”€â”€ freenaturestock_images.csv (æ•°æ®è¾“å‡ºæ–‡ä»¶)
```

## âš™ï¸ é…ç½®ä¸è¿è¡Œ

### 1\. ç¯å¢ƒå‡†å¤‡

è¯·ç¡®ä¿å®‰è£…äº†æ‰€éœ€çš„ Python åº“ï¼š

```bash
pip install requests beautifulsoup4 redis
```

### 2\. Redis é…ç½®

æœ¬é¡¹ç›®æ”¯æŒ Redis å»é‡ã€‚å¦‚æœéœ€è¦ä½¿ç”¨ Redisï¼Œè¯·ç¡®ä¿æœ¬åœ°æˆ–è¿œç¨‹çš„ Redis æœåŠ¡å·²å¯åŠ¨å¹¶å¯é€šè¿‡ä»¥ä¸‹å¸¸é‡è®¿é—®ï¼š

```python
REDIS_HOST = 'localhost'
REDIS_PORT = 6379
REDIS_KEY = 'freenaturestock_image_url_set' # ç”¨äºå­˜å‚¨å·²è®¿é—® URL çš„é›†åˆåç§°
```

å¦‚æœ Redis è¿æ¥å¤±è´¥ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨å›é€€åˆ°å†…å­˜å»é‡ã€‚

### 3\. æ–‡ä»¶è·¯å¾„é…ç½®

è¯·åŠ¡å¿…æ ¹æ®ä½ çš„æœ¬åœ°ç¯å¢ƒä¿®æ”¹ä»¥ä¸‹è·¯å¾„å¸¸é‡ï¼š

| å¸¸é‡ | æè¿° | ç¤ºä¾‹è·¯å¾„ (åŸºäºåŸå‹) |
| :--- | :--- | :--- |
| `TAG_FILE_PATH` | æœç´¢æ ‡ç­¾çš„æ–‡æœ¬æ–‡ä»¶è·¯å¾„ã€‚ | `r'D:\myproject\Code\çˆ¬è™«\çˆ¬è™«æ•°æ®\morguefile\ram_tag_list_å¤‡ä»½.txt'` |
| `CSV_DIR_PATH` | CSV æ–‡ä»¶å­˜å‚¨çš„ç›®å½•ã€‚ | `r"D:\myproject\Code\çˆ¬è™«\çˆ¬è™«æ•°æ®\freenaturestock"` |
| `CSV_FILENAME` | è¾“å‡ºçš„ CSV æ–‡ä»¶åã€‚ | `"freenaturestock_images.csv"` |

### 4\. è¿è¡Œçˆ¬è™«

åœ¨é…ç½®å¥½è·¯å¾„åï¼Œç›´æ¥è¿è¡Œ Python è„šæœ¬å³å¯ï¼š

```bash
python çˆ¬è™«ä»£ç .py
```

## æ ¸å¿ƒé€»è¾‘æ‹†è§£

### A. çˆ¬å–ä¸åˆ†é¡µ (`crawl_tag_page`)

ä½¿ç”¨å¾ªç¯è¯·æ±‚åˆ†é¡µ URLï¼Œç›´åˆ°é‡åˆ°åœæ­¢æ¡ä»¶ï¼š

```python
# Network Doc ç»“æ„
# https://freenaturestock.com/page/{é¡µç }/?s={tag}

while True:
    # 1. æ„é€ åˆ†é¡µ URL
    url = BASE_URL.format(page=page, tag=tag)
    # 2. å‘é€è¯·æ±‚
    response = requests.get(url, ...)
    
    # 3. åœæ­¢æ¡ä»¶åˆ¤æ–­
    if response.status_code == 404:
        break # 404 è®¤ä¸ºåˆ†é¡µç»“æŸ
    
    # 4. æå–å’Œå¤„ç†æ•°æ®
    new_images_count = self._extract_image_urls(response.text, tag)
    if new_images_count == 0 and page > 1:
        break # æœªæå–åˆ°æ–°é“¾æ¥ä¹Ÿè§†ä¸ºç»“æŸ
    
    page += 1
```

### B. URL æ¸…æ´—ä¸æå– (`_clean_and_get_image_info`, `_extract_image_urls`)

1.  **æå–ï¼š** ä» HTML ä¸­æŸ¥æ‰¾æ‰€æœ‰ `<img>` æ ‡ç­¾çš„ `src` å±æ€§ã€‚
2.  **è¿‡æ»¤ (æ–°è¦æ±‚):** åªä¿ç•™ä»¥ `https://freenaturestock.com/` å¼€å¤´çš„ URLã€‚
3.  **æ¸…æ´—ï¼š** ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç§»é™¤åˆ†è¾¨ç‡ä¿¡æ¯ã€‚

<!-- end list -->

```python
def _clean_and_get_image_info(self, url):
    # ç§»é™¤ "-768x512.jpg" ä¸­çš„ "-768x512" éƒ¨åˆ†
    cleaned_url = re.sub(r'-\d+x\d+(\.\w+)$', r'\1', url, flags=re.IGNORECASE)
    # ... æå–å›¾ç‰‡åç§°
    return cleaned_url, image_name
```

### C. æ•°æ®å­˜å‚¨ (`write_to_csv`)

æ•°æ®ä»¥ä»¥ä¸‹æ ¼å¼å­˜å‚¨åˆ° CSV æ–‡ä»¶ä¸­ï¼Œå¹¶ä¸¥æ ¼ä½¿ç”¨çº¿ç¨‹é”ä¿è¯æ•°æ®å®Œæ•´æ€§ã€‚

| Title | ImageName | URL | TAG |
| :--- | :--- | :--- | :--- |
| **(ç©º)** | ä» URL æå–çš„æ–‡ä»¶å | æ¸…æ´—åçš„å®Œæ•´ URL | å¯¹åº”çš„æœç´¢æ ‡ç­¾ |

```python
def write_to_csv(self, title, name, url, csv_path, tag):
    with self.csv_lock:
        # ... å†™å…¥ [title, name, url, tag]
```